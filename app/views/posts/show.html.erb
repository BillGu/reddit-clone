<% @title = @post.title %>
<% @logged_in = !!current_user %>

<section id="p-<%=@post.id%>">
    <%= button_to '+', upvote_post_url(@post) %>
    <%= button_to '-', downvote_post_url(@post) %>
    <%= @post.vote_total %>
    <h1>Post: <%= @post.title %></h1>

    <p>
        Posted by: <%= link_to @author.username, user_url(@author) %> in: 
            <% @subs.each do |sub| %>
                <%= link_to sub.title, sub_url(sub) %>
            <% end %>
        <%= @post.time_ago %> ago
    </p>

    <%= choose_url_format(@post) %>

    <p><%= @post.content %></p>

    <% if current_user == @author %>
        <%= link_to "Edit Post", edit_post_url(@post) %>
        <%= button_to "Delete Post", post_url(@post), method: :delete %>
    <% end %>
</section>

<section>
    <h2>Comments</h2>
    <% if @logged_in %>
        <%= render "comments/form", post_id: @post.id, parent_comment_id: nil %>
    <% else %>
        <p>Want to join in? Why not <%= link_to "sign up", new_user_url %>!</p>
    <% end %>

    <div class="comments">
        <%= nested_comments(@comments, :nil) %>
    </div>
</section>

<%= javascript_include_tag 'components/nested_comments' %>